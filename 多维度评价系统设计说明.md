# 多维度评价系统设计说明

## 📋 概述

本系统设计了一个多维度、多视角的评价体系，支持领导评价、同事评价、HR 评价和自评，并实现了季度评价、年度评价、离职评价等多种评价周期。

## 🎯 核心设计理念

### 1. 多维度评价视角

**评价类型（evaluation_type）：**

- **1 = 领导评价**：部门主管对下属的评价（is_leader_evaluation = true）
- **2 = 同事评价**：同部门员工之间的互相评价（is_leader_evaluation = false）
- **3 = HR 评价**：HR 对员工的评价
- **4 = 自评**：员工对自己的评价

**设计优势：**

- 360 度全方位评价，更客观全面
- 同事评价可以反映员工的团队协作能力
- 多维度数据可以交叉验证，减少主观偏见

### 2. 季度评价体系

**评价周期（evaluation_period）：**

- **1 = 季度评价**：每季度进行一次评价，记录年份和季度
- **2 = 年度评价**：每年进行一次评价，记录年份
- **3 = 离职评价**：员工离职时的评价
- **4 = 临时评价**：不定期的临时评价

**字段设计：**

- `period_year`：评价年份（如 2024）
- `period_quarter`：评价季度（1-4，仅季度评价时有效）

## 📊 数据库设计

### evaluation 表结构

```sql
CREATE TABLE `evaluation` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `employee_id` bigint NOT NULL COMMENT '被评价员工ID',
  `employee_profile_id` bigint NULL COMMENT '关联的员工档案ID',
  `evaluator_id` bigint NOT NULL COMMENT '评价人ID',
  `score` tinyint NOT NULL COMMENT '评分（0-100分）',
  `comment` text NULL COMMENT '评价内容',
  `evaluation_date` date NOT NULL COMMENT '评价日期',
  `is_leader_evaluation` tinyint(1) NOT NULL COMMENT '是否为领导评价',
  `evaluation_type` tinyint NOT NULL DEFAULT 1 COMMENT '评价类型（1=领导评价，2=同事评价，3=HR评价，4=自评）',
  `evaluation_period` tinyint NULL COMMENT '评价周期（1=季度评价，2=年度评价，3=离职评价，4=临时评价）',
  `period_year` int NULL COMMENT '评价年份（如2024）',
  `period_quarter` tinyint NULL COMMENT '评价季度（1-4，仅季度评价时有效）',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `is_delete` tinyint(1) DEFAULT 0,
  PRIMARY KEY (`id`),
  INDEX `idx_evaluation_employee`(`employee_id`),
  INDEX `idx_evaluation_type`(`evaluation_type`),
  INDEX `idx_evaluation_period`(`evaluation_period`, `period_year`, `period_quarter`),
  INDEX `idx_evaluator_employee`(`evaluator_id`, `employee_id`)
) COMMENT='员工评价记录';
```

## 🔄 业务流程

### 1. 季度评价流程

```
1. 系统定时任务（每季度初）
   ↓
2. 生成评价任务
   - 为每个部门生成评价任务
   - 通知部门主管
   ↓
3. 部门主管评价
   - 部门主管对下属进行评价
   - 填写标签、维度评分、评价内容
   ↓
4. 同事评价（可选）
   - 同部门员工可以互相评价
   - 系统提示可评价的同事列表
   ↓
5. 评价汇总
   - 系统自动汇总所有评价
   - 生成评价报告
```

### 2. 同事评价流程

```
1. 员工登录系统
   ↓
2. 查看评价任务
   - 显示需要评价的同事列表
   - 显示已完成的评价
   ↓
3. 选择同事进行评价
   - 验证是否为同部门
   - 填写评价表单（标签、维度、内容）
   ↓
4. 提交评价
   - 保存评价记录
   - 更新评价统计
```

### 3. 离职评价流程

```
1. HR发起离职流程
   ↓
2. 系统自动生成离职评价任务
   - 通知部门主管
   - 通知HR
   ↓
3. 完成离职评价
   - 部门主管完成评价
   - HR完成评价
   ↓
4. 评价归档
   - 评价关联到员工档案
   - 作为离职档案的一部分
```

## 💻 业务逻辑实现

### 1. 同事评价权限验证

```java
/**
 * 验证是否可以评价同事
 * @param evaluatorId 评价人ID
 * @param employeeId 被评价员工ID
 * @return 是否可以评价
 */
public boolean canEvaluateColleague(Long evaluatorId, Long employeeId) {
    // 1. 获取评价人信息
    Employee evaluator = employeeService.getById(evaluatorId);
    // 2. 获取被评价人信息
    Employee employee = employeeService.getById(employeeId);

    // 3. 验证是否为同部门
    if (evaluator.getDepartmentId() == null ||
        employee.getDepartmentId() == null) {
        return false;
    }

    // 4. 验证是否为同一部门
    if (!evaluator.getDepartmentId().equals(employee.getDepartmentId())) {
        return false;
    }

    // 5. 验证是否为同一人
    if (evaluatorId.equals(employeeId)) {
        return false; // 不能评价自己（自评使用evaluation_type=4）
    }

    // 6. 验证是否已经评价过（同一周期内）
    // 可以设置规则：同一季度只能评价一次

    return true;
}
```

### 2. 季度评价任务生成

```java
/**
 * 生成季度评价任务
 * @param year 年份
 * @param quarter 季度（1-4）
 */
@Scheduled(cron = "0 0 0 1 1,4,7,10 ?") // 每季度第一天执行
public void generateQuarterlyEvaluationTasks() {
    int year = LocalDate.now().getYear();
    int quarter = (LocalDate.now().getMonthValue() - 1) / 3 + 1;

    // 1. 获取所有部门
    List<Department> departments = departmentService.list();

    // 2. 为每个部门生成评价任务
    for (Department department : departments) {
        // 3. 获取部门员工
        List<Employee> employees = employeeService.list(
            QueryWrapper.create()
                .eq("department_id", department.getId())
                .eq("status", 1) // 在职
        );

        // 4. 为每个员工创建评价任务通知
        for (Employee employee : employees) {
            // 通知部门主管
            if (department.getLeaderId() != null) {
                notificationService.createEvaluationTaskNotification(
                    department.getLeaderId(),
                    employee.getId(),
                    year,
                    quarter
                );
            }

            // 通知同部门同事（可选）
            // 可以设置规则：通知所有同事，或只通知部分同事
        }
    }
}
```

### 3. 评价权重计算

```java
/**
 * 计算员工综合评分
 * @param employeeId 员工ID
 * @param periodYear 评价年份
 * @param periodQuarter 评价季度
 * @return 综合评分
 */
public BigDecimal calculateComprehensiveScore(Long employeeId,
                                               Integer periodYear,
                                               Integer periodQuarter) {
    // 1. 获取该季度的所有评价
    List<Evaluation> evaluations = evaluationService.list(
        QueryWrapper.create()
            .eq("employee_id", employeeId)
            .eq("evaluation_period", 1) // 季度评价
            .eq("period_year", periodYear)
            .eq("period_quarter", periodQuarter)
    );

    // 2. 按评价类型分组
    Map<Integer, List<Evaluation>> evaluationsByType = evaluations.stream()
        .collect(Collectors.groupingBy(Evaluation::getEvaluationType));

    // 3. 计算各类型平均分
    BigDecimal leaderScore = calculateAverageScore(
        evaluationsByType.get(1), // 领导评价
        new BigDecimal("0.4") // 权重40%
    );

    BigDecimal colleagueScore = calculateAverageScore(
        evaluationsByType.get(2), // 同事评价
        new BigDecimal("0.3") // 权重30%
    );

    BigDecimal hrScore = calculateAverageScore(
        evaluationsByType.get(3), // HR评价
        new BigDecimal("0.3") // 权重30%
    );

    // 4. 加权平均
    return leaderScore.add(colleagueScore).add(hrScore);
}
```

## 📈 评价统计与分析

### 1. 评价趋势分析

- 按季度查看员工评价趋势
- 对比不同评价类型的评分
- 识别评价异常（如突然下降）

### 2. 多维度评价对比

- 领导评价 vs 同事评价
- 不同评价周期的对比
- 评价一致性分析

### 3. 评价报告生成

- 季度评价报告
- 年度评价报告
- 离职评价报告

## 🔒 权限控制

### 1. 评价权限

- **部门主管**：可以评价本部门所有员工
- **同事**：可以评价同部门同事（需验证）
- **HR**：可以评价本公司所有员工
- **员工**：可以自评

### 2. 查看权限

- **员工**：可以查看自己的所有评价
- **部门主管**：可以查看本部门员工的评价
- **HR**：可以查看本公司员工的评价
- **外部企业**：需要员工授权才能查看

## 🎨 前端界面设计建议

### 1. 评价任务列表

- 显示待评价的员工列表
- 区分领导评价和同事评价任务
- 显示评价进度

### 2. 评价表单

- 标签选择（多选）
- 维度评分（1-5 分）
- 评价内容输入
- 评价类型标识

### 3. 评价统计

- 雷达图展示多维度评分
- 折线图展示评价趋势
- 对比图展示不同评价类型

## ✅ 实施优先级

**第一优先级（核心功能）**

1. ✅ 修复 evaluation 表结构
2. ✅ 实现多维度评价类型支持
3. ✅ 实现季度评价体系
4. ✅ 实现同事评价功能
5. ✅ 实现评价 CRUD 接口
6. ✅ 实现评价查询和统计

**第二优先级（增强功能）**

1. 实现定时任务（季度评价任务生成）
2. 实现评价权重计算
3. 实现评价报告生成
4. 实现评价趋势分析

**第三优先级（优化功能）**

1. 评价模板管理
2. 评价数据分析
3. 评价可视化优化

## 📝 注意事项

1. **数据一致性**：使用索引而非外键，需要在应用层保证数据一致性
2. **评价频率控制**：同一周期内，同一人对同一人只能评价一次
3. **评价权重配置**：评价权重可以配置化，便于调整
4. **评价匿名性**：同事评价可以考虑匿名，减少顾虑
5. **评价反馈**：员工可以对评价进行反馈或投诉

## 🚀 总结

多维度评价系统通过支持领导评价、同事评价、HR 评价和自评，以及季度评价、年度评价、离职评价等多种评价周期，打造了一个全方位、多视角的人才评价体系。这不仅能够更客观地评估员工能力，还能帮助企业更好地进行人才管理和招聘决策。
