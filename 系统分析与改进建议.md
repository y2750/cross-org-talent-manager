# 跨组织人才管理系统 - 功能分析与改进建议

## 一、已实现功能概览

### ✅ 已完成的核心模块

1. **用户管理系统**

   - 用户注册、登录、认证
   - 角色管理（管理员、HR、公司管理员、员工）
   - 权限控制（@AuthCheck 注解）

2. **企业管理**

   - 企业注册与认证
   - 企业信息管理（行业分类、联系方式等）
   - 企业积分表结构（company_points 表已创建）

3. **部门管理**

   - 部门创建与管理
   - 部门主管设置
   - 部门与企业的关联

4. **员工管理**

   - 员工基本信息管理（姓名、身份证、联系方式等）
   - 员工入职/离职流程
   - 员工部门分配
   - 数据脱敏处理（电话、邮箱、身份证号）
   - 员工照片上传

5. **员工档案管理**

   - 档案创建与维护
   - 绩效摘要、出勤率、重大违纪记录
   - 离职原因、年薪等信息记录

6. **奖惩记录**
   - 奖励/惩罚记录管理
   - 金额、日期、描述等信息

---

## 二、待实现功能清单

### 🔴 高优先级（核心业务功能）

#### 1. 多维度评价系统（Evaluation System）⭐ **第一优先级**

**现状：** 数据库表已存在，但缺少完整的业务实现

**核心需求：**

- **多维度评价视角**：支持领导评价、同事评价、HR 评价、自评等多种评价类型
- **季度评价体系**：支持季度评价、年度评价、离职评价、临时评价
- **同事评价**：同部门员工作为同事可以互相评价，打造 360 度评价体系

**需要实现：**

- [ ] 评价实体类、Mapper、Service、Controller
- [ ] 评价与员工的关联（**数据库问题：evaluation 表缺少 employee_id 字段**）
- [ ] 评价与档案的关联
- [ ] **多维度评价类型支持**：
  - 领导评价（is_leader_evaluation = true，evaluation_type = 1）
  - 同事评价（is_leader_evaluation = false，evaluation_type = 2，同部门员工）
  - HR 评价（evaluation_type = 3）
  - 自评（evaluation_type = 4）
- [ ] **季度评价体系支持**：
  - 季度评价（evaluation_period = 1，需记录 period_year 和 period_quarter）
  - 年度评价（evaluation_period = 2，需记录 period_year）
  - 离职评价（evaluation_period = 3）
  - 临时评价（evaluation_period = 4）
- [ ] 评价的创建、查询、更新、删除
- [ ] 评价列表展示（按员工、按公司、按时间、按评价类型、按评价周期）
- [ ] 季度评价任务自动生成（定时任务）
- [ ] 离职时自动触发离职评价流程

**数据库改进：**

```sql
-- evaluation表需要添加以下字段
ALTER TABLE `evaluation`
ADD COLUMN `employee_id` bigint NOT NULL COMMENT '被评价员工ID' AFTER `id`,
ADD COLUMN `employee_profile_id` bigint NULL COMMENT '关联的员工档案ID' AFTER `employee_id`,
ADD COLUMN `evaluation_type` tinyint NOT NULL DEFAULT 1 COMMENT '评价类型（1=领导评价，2=同事评价，3=HR评价，4=自评）' AFTER `is_leader_evaluation`,
ADD COLUMN `evaluation_period` tinyint NULL COMMENT '评价周期（1=季度评价，2=年度评价，3=离职评价，4=临时评价）' AFTER `evaluation_type`,
ADD COLUMN `period_year` int NULL COMMENT '评价年份（如2024）' AFTER `evaluation_period`,
ADD COLUMN `period_quarter` tinyint NULL COMMENT '评价季度（1-4，仅季度评价时有效）' AFTER `period_year`,
ADD INDEX `idx_evaluation_employee`(`employee_id`),
ADD INDEX `idx_evaluation_type`(`evaluation_type`),
ADD INDEX `idx_evaluation_period`(`evaluation_period`, `period_year`, `period_quarter`);
```

**业务逻辑说明：**

1. **同事评价规则**：

   - 同部门员工可以互相评价
   - 评价时需要验证评价人和被评价人是否在同一部门
   - 同事评价的权重可以设置（如 0.3，领导评价权重 0.7）

2. **季度评价流程**：

   - 系统在每季度初自动生成评价任务
   - 部门主管收到评价任务通知
   - 部门主管和同事都可以对员工进行评价
   - 支持按季度查询和统计评价数据

3. **离职评价**：
   - 员工离职时自动触发离职评价流程
   - HR 和部门主管必须完成离职评价
   - 离职评价作为员工档案的重要组成部分

#### 2. 标签化评价系统

**现状：** 完全缺失

**需要实现：**

- [ ] 评价标签表（evaluation_tag）
- [ ] 标签类型管理（正面标签、中性标签）
- [ ] 评价与标签的多对多关联表
- [ ] 标签选择限制（只能从预设标签中选择）
- [ ] 标签库管理（系统管理员维护）

**数据库设计：**

```sql
-- 评价标签表
CREATE TABLE `evaluation_tag` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT '标签名称',
  `type` tinyint NOT NULL COMMENT '标签类型（1=正面，2=中性）',
  `description` varchar(255) NULL COMMENT '标签描述',
  `sort_order` int DEFAULT 0 COMMENT '排序',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否启用',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `is_delete` tinyint(1) DEFAULT 0,
  PRIMARY KEY (`id`),
  INDEX `idx_type`(`type`)
) COMMENT='评价标签库';

-- 评价与标签关联表
CREATE TABLE `evaluation_tag_relation` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `evaluation_id` bigint NOT NULL COMMENT '评价ID',
  `tag_id` bigint NOT NULL COMMENT '标签ID',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_evaluation_tag`(`evaluation_id`, `tag_id`),
  INDEX `fk_tag_relation_evaluation`(`evaluation_id`),
  INDEX `fk_tag_relation_tag`(`tag_id`),
  CONSTRAINT `fk_tag_relation_evaluation` FOREIGN KEY (`evaluation_id`) REFERENCES `evaluation` (`id`),
  CONSTRAINT `fk_tag_relation_tag` FOREIGN KEY (`tag_id`) REFERENCES `evaluation_tag` (`id`)
) COMMENT='评价标签关联表';
```

#### 3. 维度评分系统

**现状：** 完全缺失

**需要实现：**

- [ ] 评价维度表（evaluation_dimension）
- [ ] 维度评分记录表（evaluation_dimension_score）
- [ ] 固定考核维度（工作业绩、责任心、专业技能、团队协作、创新能力等）
- [ ] 1-5 分评分机制
- [ ] 雷达图数据生成接口

**数据库设计：**

```sql
-- 评价维度表
CREATE TABLE `evaluation_dimension` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT '维度名称',
  `description` varchar(255) NULL COMMENT '维度描述',
  `sort_order` int DEFAULT 0 COMMENT '排序',
  `is_active` tinyint(1) DEFAULT 1,
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `is_delete` tinyint(1) DEFAULT 0,
  PRIMARY KEY (`id`)
) COMMENT='评价维度配置表';

-- 维度评分记录表
CREATE TABLE `evaluation_dimension_score` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `evaluation_id` bigint NOT NULL COMMENT '评价ID',
  `dimension_id` bigint NOT NULL COMMENT '维度ID',
  `score` tinyint NOT NULL COMMENT '评分（1-5分）',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_evaluation_dimension`(`evaluation_id`, `dimension_id`),
  INDEX `fk_dimension_score_evaluation`(`evaluation_id`),
  INDEX `fk_dimension_score_dimension`(`dimension_id`),
  CONSTRAINT `fk_dimension_score_evaluation` FOREIGN KEY (`evaluation_id`) REFERENCES `evaluation` (`id`),
  CONSTRAINT `fk_dimension_score_dimension` FOREIGN KEY (`dimension_id`) REFERENCES `evaluation_dimension` (`id`),
  CONSTRAINT `chk_score_range` CHECK (`score` BETWEEN 1 AND 5)
) COMMENT='维度评分记录表';
```

#### 4. 企业积分系统

**现状：** 表结构已存在，但缺少业务逻辑实现

**需要实现：**

- [ ] 积分计算服务（CompanyPointsService）
- [ ] 积分获取规则：
  - 为离职员工建立完整档案：+10 分
  - 收到员工好评：+5 分
  - 提供客观评价：根据评价质量加分
- [ ] 积分消耗/权益：
  - 优先检索人才库
  - 获得平台首页推荐位
  - 解锁高级分析功能
- [ ] 积分查询接口
- [ ] 积分变动记录查询

**数据库改进：**

```sql
-- company_points表的change_reason字段注释需要完善
-- 建议添加积分类型枚举表或使用更清晰的枚举值
-- 1=建立档案，2=员工评价，3=员工好评，4=其他

-- 建议添加企业当前总积分字段到company表（或通过视图计算）
ALTER TABLE `company`
ADD COLUMN `total_points` decimal(12, 2) DEFAULT 0 COMMENT '当前总积分' AFTER `industry`;
```

#### 5. 档案查阅请求系统

**现状：** 完全缺失

**需要实现：**

- [ ] 查阅请求表（profile_access_request）
- [ ] 企业发起查阅请求
- [ ] 员工授权/拒绝请求
- [ ] 请求状态管理（待处理、已授权、已拒绝、已过期）
- [ ] 请求通知系统
- [ ] 查阅记录审计

**数据库设计：**

```sql
-- 档案查阅请求表
CREATE TABLE `profile_access_request` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `request_company_id` bigint NOT NULL COMMENT '请求企业ID',
  `employee_id` bigint NOT NULL COMMENT '员工ID',
  `employee_profile_id` bigint NULL COMMENT '请求查阅的档案ID（可选，为空表示查阅所有档案）',
  `request_reason` varchar(500) NULL COMMENT '请求原因',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '状态（0=待处理，1=已授权，2=已拒绝，3=已过期）',
  `request_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '请求时间',
  `response_time` datetime NULL COMMENT '响应时间',
  `expire_time` datetime NULL COMMENT '授权过期时间',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `is_delete` tinyint(1) DEFAULT 0,
  PRIMARY KEY (`id`),
  INDEX `fk_request_company`(`request_company_id`),
  INDEX `fk_request_employee`(`employee_id`),
  INDEX `fk_request_profile`(`employee_profile_id`),
  INDEX `idx_status`(`status`),
  CONSTRAINT `fk_request_company` FOREIGN KEY (`request_company_id`) REFERENCES `company` (`id`),
  CONSTRAINT `fk_request_employee` FOREIGN KEY (`employee_id`) REFERENCES `employee` (`id`),
  CONSTRAINT `fk_request_profile` FOREIGN KEY (`employee_profile_id`) REFERENCES `employee_profile` (`id`)
) COMMENT='档案查阅请求表';

-- 档案查阅记录表（审计用）
CREATE TABLE `profile_access_log` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `request_id` bigint NOT NULL COMMENT '请求ID',
  `access_company_id` bigint NOT NULL COMMENT '查阅企业ID',
  `employee_id` bigint NOT NULL COMMENT '员工ID',
  `employee_profile_id` bigint NOT NULL COMMENT '被查阅的档案ID',
  `access_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '查阅时间',
  `ip_address` varchar(50) NULL COMMENT 'IP地址',
  PRIMARY KEY (`id`),
  INDEX `fk_log_request`(`request_id`),
  INDEX `fk_log_company`(`access_company_id`),
  INDEX `fk_log_employee`(`employee_id`),
  INDEX `fk_log_profile`(`employee_profile_id`),
  INDEX `idx_access_time`(`access_time`)
) COMMENT='档案查阅记录表';
```

#### 6. 员工档案权限管理

**现状：** 完全缺失

**需要实现：**

- [ ] 档案公开范围设置（完全保密、对认证企业可见、公开）
- [ ] 员工查看自己的档案
- [ ] 员工管理查阅请求
- [ ] 档案脱敏规则（根据权限显示不同信息）

**数据库设计：**

```sql
-- 在employee_profile表中添加公开范围字段
ALTER TABLE `employee_profile`
ADD COLUMN `visibility` tinyint DEFAULT 0 COMMENT '公开范围（0=完全保密，1=对认证企业可见，2=公开）' AFTER `operator_id`;
```

### 🟡 中优先级（增强功能）

#### 7. 评价任务通知系统

**需要实现：**

- [ ] 通知表（notification）
- [ ] 定时任务（季度/年度/离职评价提醒）
- [ ] 部门主管接收评价任务通知
- [ ] 通知状态管理（未读、已读、已处理）

**数据库设计：**

```sql
-- 通知表
CREATE TABLE `notification` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `user_id` bigint NOT NULL COMMENT '接收用户ID',
  `type` tinyint NOT NULL COMMENT '通知类型（1=评价任务，2=查阅请求，3=系统通知）',
  `title` varchar(200) NOT NULL COMMENT '通知标题',
  `content` text NULL COMMENT '通知内容',
  `related_id` bigint NULL COMMENT '关联ID（如评价任务ID、请求ID等）',
  `status` tinyint DEFAULT 0 COMMENT '状态（0=未读，1=已读，2=已处理）',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `is_delete` tinyint(1) DEFAULT 0,
  PRIMARY KEY (`id`),
  INDEX `fk_notification_user`(`user_id`),
  INDEX `idx_status`(`status`),
  INDEX `idx_type`(`type`)
) COMMENT='通知表';
```

#### 8. 投诉与反馈系统

**需要实现：**

- [ ] 投诉表（complaint）
- [ ] 员工对恶意评价的投诉
- [ ] 投诉处理流程
- [ ] 系统管理员处理投诉

**数据库设计：**

```sql
-- 投诉表
CREATE TABLE `complaint` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `complainant_id` bigint NOT NULL COMMENT '投诉人ID（员工）',
  `evaluation_id` bigint NULL COMMENT '被投诉的评价ID',
  `company_id` bigint NULL COMMENT '被投诉的企业ID',
  `type` tinyint NOT NULL COMMENT '投诉类型（1=恶意评价，2=虚假信息，3=其他）',
  `title` varchar(200) NOT NULL COMMENT '投诉标题',
  `content` text NOT NULL COMMENT '投诉内容',
  `evidence` text NULL COMMENT '证据（JSON格式，可包含图片、链接等）',
  `status` tinyint DEFAULT 0 COMMENT '状态（0=待处理，1=处理中，2=已处理，3=已驳回）',
  `handler_id` bigint NULL COMMENT '处理人ID（系统管理员）',
  `handle_result` text NULL COMMENT '处理结果',
  `handle_time` datetime NULL COMMENT '处理时间',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `is_delete` tinyint(1) DEFAULT 0,
  PRIMARY KEY (`id`),
  INDEX `fk_complaint_complainant`(`complainant_id`),
  INDEX `fk_complaint_evaluation`(`evaluation_id`),
  INDEX `fk_complaint_company`(`company_id`),
  INDEX `idx_status`(`status`)
) COMMENT='投诉表';
```

#### 9. 人才看板功能

**需要实现：**

- [ ] HR 人才看板数据统计
- [ ] 所管理人才的成长地图
- [ ] 人才分布统计（按部门、按岗位）
- [ ] 人才评价趋势分析
- [ ] 数据可视化接口

#### 10. 人才库搜索与筛选

**需要实现：**

- [ ] 人才库搜索接口（支持多条件筛选）
- [ ] 按积分优先级排序
- [ ] 按行业、岗位、评价标签筛选
- [ ] 搜索结果脱敏处理
- [ ] 高级搜索功能（积分高的企业可用）

### 🟢 低优先级（优化功能）

#### 11. 评价模板管理

**需要实现：**

- [ ] 评价模板表（evaluation_template）
- [ ] 系统预设评价模板
- [ ] 企业自定义评价模板
- [ ] 模板使用统计

#### 12. 数据统计分析

**需要实现：**

- [ ] 企业人才统计
- [ ] 评价质量分析
- [ ] 行业人才分布
- [ ] 系统使用情况统计

---

## 三、数据库改进建议

### 1. 现有表结构问题

#### evaluation 表缺少关键字段

```sql
-- 问题：无法关联被评价的员工
ALTER TABLE `evaluation`
ADD COLUMN `employee_id` bigint NOT NULL COMMENT '被评价员工ID' AFTER `id`,
ADD COLUMN `employee_profile_id` bigint NULL COMMENT '关联的员工档案ID' AFTER `employee_id`,
ADD INDEX `fk_evaluation_employee`(`employee_id`),
ADD CONSTRAINT `fk_evaluation_employee` FOREIGN KEY (`employee_id`) REFERENCES `employee` (`id`);
```

#### department 表的 leader_id 字段

```sql
-- 问题：leader_id设置为NOT NULL，但可能没有主管
-- 建议改为可空
ALTER TABLE `department`
MODIFY COLUMN `leader_id` bigint NULL DEFAULT NULL COMMENT '部门领导';
```

#### company_points 表的 change_reason 字段

```sql
-- 问题：注释不清晰，建议使用枚举值
-- 1=建立档案，2=员工评价，3=员工好评，4=其他
-- 或者创建枚举表
```

### 2. 索引优化建议

```sql
-- employee表添加常用查询索引
ALTER TABLE `employee`
ADD INDEX `idx_company_status`(`company_id`, `status`),
ADD INDEX `idx_department`(`department_id`);

-- employee_profile表添加索引
ALTER TABLE `employee_profile`
ADD INDEX `idx_employee_company`(`employee_id`, `company_id`),
ADD INDEX `idx_start_date`(`start_date`);

-- evaluation表（添加employee_id后）
ALTER TABLE `evaluation`
ADD INDEX `idx_employee_date`(`employee_id`, `evaluation_date`);
```

### 3. 数据完整性约束

```sql
-- 确保employee_profile的start_date <= end_date
ALTER TABLE `employee_profile`
ADD CONSTRAINT `chk_date_range` CHECK (`end_date` IS NULL OR `start_date` <= `end_date`);

-- 确保company_points的积分变动合理
ALTER TABLE `company_points`
ADD CONSTRAINT `chk_points_reason` CHECK (
  (`change_reason` = 1 AND `with_employee_id` IS NOT NULL) OR
  (`change_reason` = 2 AND `with_employee_id` IS NOT NULL AND `score` IS NOT NULL) OR
  (`change_reason` = 3 AND `with_employee_id` IS NOT NULL)
);
```

---

## 四、系统架构改进建议

### 1. 服务层改进

#### 评价服务（EvaluationService）

- 创建评价时自动计算企业积分
- 评价与档案的关联管理
- 评价统计与分析

#### 积分服务（CompanyPointsService）

- 积分计算规则封装
- 积分变动记录
- 积分查询与统计

#### 通知服务（NotificationService）

- 通知创建与发送
- 通知状态管理
- 定时任务集成

### 2. 权限控制增强

#### 数据脱敏策略

- 根据用户角色和关系决定脱敏程度
- 部门主管查看本部门员工不脱敏
- 外部企业查看需要授权且脱敏

#### 档案访问控制

- 员工只能查看自己的档案
- HR 只能查看本公司员工的档案
- 外部企业需要员工授权才能查看

### 3. 定时任务实现

#### 评价任务提醒

- 季度评价提醒（每季度初）
- 年度评价提醒（每年初）
- 离职评价提醒（员工离职时）

#### 积分计算

- 定期计算企业总积分
- 积分过期处理（如有）

---

## 五、前端功能需求

### 1. 评价管理界面

- 评价创建表单（标签选择、维度评分）
- 评价列表展示
- 评价详情查看
- 雷达图展示

### 2. 档案查阅请求界面

- 发起查阅请求
- 处理查阅请求（员工端）
- 查阅记录查看

### 3. 积分管理界面

- 积分查询
- 积分变动记录
- 积分权益说明

### 4. 人才看板界面

- 数据可视化图表
- 人才成长地图
- 统计分析报表

---

## 六、实施优先级建议

### 第一阶段（核心功能）⭐ **第一优先级**

1. ✅ 修复 evaluation 表结构（添加 employee_id、evaluation_type、evaluation_period 等字段）
2. ✅ 实现多维度评价系统（支持领导评价、同事评价、HR 评价、自评）
3. ✅ 实现季度评价体系（季度评价、年度评价、离职评价）
4. ✅ 实现同事评价功能（同部门员工互相评价）
5. ✅ 实现标签化评价系统
6. ✅ 实现维度评分系统
7. ✅ 实现企业积分系统基础功能

### 第二阶段（权限与安全）

1. ✅ 实现档案查阅请求系统
2. ✅ 实现员工授权管理
3. ✅ 增强数据脱敏策略
4. ✅ 实现投诉系统

### 第三阶段（增强功能）

1. ✅ 实现通知系统
2. ✅ 实现定时任务
3. ✅ 实现人才看板
4. ✅ 实现人才库搜索

### 第四阶段（优化与扩展）

1. ✅ 评价模板管理
2. ✅ 数据统计分析
3. ✅ 性能优化
4. ✅ 用户体验优化

---

## 七、技术债务与注意事项

### 1. 数据迁移

- 如果 evaluation 表已有数据，需要数据迁移脚本
- 新增字段的默认值处理

### 2. 性能考虑

- 评价统计查询可能较慢，考虑添加缓存
- 人才库搜索需要全文索引优化
- 大数据量时的分页优化

### 3. 安全性

- 身份证号等敏感信息加密存储
- API 接口的权限验证
- 防止 SQL 注入、XSS 攻击

### 4. 可扩展性

- 评价维度可配置化
- 积分规则可配置化
- 标签库可动态管理

---

## 八、总结

当前系统已完成了基础框架和核心业务模块，但在评价系统、权限管理、积分系统等关键功能上还需要大量开发工作。建议按照优先级逐步实施，先完成核心功能，再逐步完善增强功能。

**关键改进点：**

1. **数据库结构完善**：修复 evaluation 表，添加必要的关联表和配置表
2. **评价系统实现**：标签化评价、维度评分、评价管理
3. **权限与安全**：档案查阅请求、授权管理、数据脱敏
4. **积分系统**：积分计算、权益管理、统计查询
5. **用户体验**：通知系统、人才看板、搜索功能

通过系统化的改进，可以构建一个功能完善、安全可靠的跨组织人才管理系统。
